{"ast":null,"code":"import { onMounted, reactive, ref } from 'vue';\nimport axios from 'axios';\nimport { ElMessage } from 'element-plus';\nexport default {\n  __name: 'ListAfter',\n  setup(__props, {\n    expose: __expose\n  }) {\n    __expose();\n    const afterSaleList = ref([]);\n    const total = ref(0);\n    const condForm = reactive({\n      id: '',\n      question: '',\n      grade: '',\n      level: ''\n    });\n    function queryAfterSaleList(pageNum) {\n      condForm.pageNum = pageNum;\n      axios.post(\"http://localhost:8081/listAfterSale\", condForm).then(response => {\n        afterSaleList.value = response.data.afterSalesList;\n        total.value = response.data.total;\n      }).catch(error => {\n        console.log(error);\n      });\n    }\n    onMounted(function () {\n      queryAfterSaleList(1);\n    });\n    function afterSalePageChange(pageNum) {\n      queryAfterSaleList(pageNum);\n    }\n    function subQueryAfter() {\n      queryAfterSaleList(1);\n    }\n    const dialogReplayVisible = ref(false);\n    const dialogWidth = ref('50%');\n    const replayForm = reactive({\n      content: ''\n    });\n    onMounted(() => {\n      updateDialogWidth();\n      window.addEventListener('resize', updateDialogWidth);\n    });\n    function updateDialogWidth() {\n      dialogWidth.value = window.innerWidth < 768 ? '90%' : '50%';\n    }\n    function openReplayDialog(qid) {\n      dialogReplayVisible.value = true;\n      replayForm.quesId = qid;\n    }\n    function subReplayForm() {\n      axios.post(\"http://localhost:8081/saveReplay\", replayForm).then(response => {\n        if (response.data.code == 200) {\n          dialogReplayVisible.value = false;\n          replayForm.content = '';\n          ElMessage(response.data.msg);\n        } else {\n          ElMessage.error(response.data.msg);\n        }\n      }).catch(error => {\n        console.log(error);\n      });\n    }\n    const dialogReplayListVisible = ref(false);\n    const question = reactive({\n      custName: '',\n      quesDesc: ''\n    });\n    const totalReplay = ref(0);\n    const replaysList = ref([]);\n    let qid = 0;\n    function loadQuesttionReplayList(row) {\n      dialogReplayListVisible.value = true;\n      question.custName = row.custName;\n      question.quesDesc = row.question;\n      qid = row.id;\n      //发送ajax请求\n      axios.get(\"http://localhost:8081/listReplay?id=\" + row.id).then(response => {\n        replaysList.value = response.data.replayList;\n        totalReplay.value = response.data.total;\n      }).catch(error => {\n        console.log(error);\n      });\n    }\n\n    //提交分页查询参数的请求\n    function handlerReplayPageChange(pageNum) {\n      //发送ajax请求\n      axios.get(\"http://localhost:8081/listReplay?id=\" + qid + \"&pageNum=\" + pageNum).then(response => {\n        replaysList.value = response.data.replayList;\n        totalReplay.value = response.data.total;\n      }).catch(error => {\n        console.log(error);\n      });\n    }\n    const __returned__ = {\n      afterSaleList,\n      total,\n      condForm,\n      queryAfterSaleList,\n      afterSalePageChange,\n      subQueryAfter,\n      dialogReplayVisible,\n      dialogWidth,\n      replayForm,\n      updateDialogWidth,\n      openReplayDialog,\n      subReplayForm,\n      dialogReplayListVisible,\n      question,\n      totalReplay,\n      replaysList,\n      get qid() {\n        return qid;\n      },\n      set qid(v) {\n        qid = v;\n      },\n      loadQuesttionReplayList,\n      handlerReplayPageChange,\n      onMounted,\n      reactive,\n      ref,\n      get axios() {\n        return axios;\n      },\n      get ElMessage() {\n        return ElMessage;\n      }\n    };\n    Object.defineProperty(__returned__, '__isScriptSetup', {\n      enumerable: false,\n      value: true\n    });\n    return __returned__;\n  }\n};","map":{"version":3,"names":["onMounted","reactive","ref","axios","ElMessage","afterSaleList","total","condForm","id","question","grade","level","queryAfterSaleList","pageNum","post","then","response","value","data","afterSalesList","catch","error","console","log","afterSalePageChange","subQueryAfter","dialogReplayVisible","dialogWidth","replayForm","content","updateDialogWidth","window","addEventListener","innerWidth","openReplayDialog","qid","quesId","subReplayForm","code","msg","dialogReplayListVisible","custName","quesDesc","totalReplay","replaysList","loadQuesttionReplayList","row","get","replayList","handlerReplayPageChange"],"sources":["D:/Program/Java QP/Erp/erpfront/src/views/ListAfter.vue"],"sourcesContent":["<template>\r\n  <h2>客户投诉</h2>\r\n  <el-form :model=\"condForm\">\r\n    <el-row :gutter=\"20\">\r\n      <el-col :span=\"6\">\r\n        <el-form-item label=\"投诉单号\">\r\n          <el-input v-model=\"condForm.id\" />\r\n        </el-form-item>\r\n      </el-col>\r\n      <el-col :span=\"6\">\r\n        <el-form-item label=\"问题描述\">\r\n          <el-input v-model=\"condForm.question\" />\r\n        </el-form-item>\r\n      </el-col>\r\n      <el-col :span=\"6\">\r\n        <el-form-item label=\"紧急程度\">\r\n          <el-select\r\n          v-model=\"condForm.grade\"\r\n          placeholder=\"请选择紧急程度...\"\r\n          clearable\r\n          >\r\n          <el-option label=\"普通\" value=\"普通\" />\r\n          <el-option label=\"加急\" value=\"加急\" />\r\n        </el-select>\r\n      </el-form-item>\r\n    </el-col>\r\n    <el-col :span=\"6\">\r\n      <el-form-item label=\"处理状态\">\r\n        <el-select\r\n        v-model=\"condForm.state\"\r\n        placeholder=\"请选择...\"\r\n        clearable\r\n        >\r\n        <el-option label=\"未处理\" value=\"未处理\" />\r\n        <el-option label=\"已处理\" value=\"已处理\" />\r\n        <el-option label=\"未回访\" value=\"未回访\" />\r\n        <el-option label=\"已回访\" value=\"已回访\" />\r\n      </el-select>\r\n    </el-form-item>\r\n  </el-col>\r\n</el-row>\r\n<el-row>\r\n  <el-col :span=\"24\" style=\"text-align: right; margin-top: 10px\">\r\n    <el-form-item>\r\n      <el-button type=\"primary\" @click=\"subQueryAfter\">查询</el-button>\r\n    </el-form-item>\r\n  </el-col>\r\n</el-row>\r\n</el-form>\r\n\r\n<el-table :data=\"afterSaleList\" style=\"width: 100%\">\r\n  <el-table-column prop=\"id\" label=\"投诉编号\"  />\r\n  <el-table-column prop=\"custName\" label=\"客户姓名\" />\r\n  <el-table-column prop=\"question\" label=\"问题类型\" />\r\n  <el-table-column prop=\"state\" label=\"处理状态\" />\r\n  <el-table-column prop=\"grade\" label=\"紧急程度\" />\r\n  <el-table-column prop=\"level\" label=\"投诉满意度\" />\r\n  \r\n  <el-table-column fixed=\"right\" label=\"操作\">\r\n    <template #default=\"scope\">\r\n      <el-button link type=\"primary\" size=\"small\" @click=\"openReplayDialog(scope.row.id)\">处理</el-button>\r\n      <el-button link type=\"primary\" size=\"small\" @click=\"loadQuesttionReplayList(scope.row)\">查看处理详情</el-button>\r\n    </template>\r\n  </el-table-column>\r\n</el-table>\r\n<hr/>\r\n<el-pagination\r\n:page-size=\"6\"\r\n:pager-count=\"10\"\r\nlayout=\"prev, pager, next\"\r\n:total=\"total\"\r\nclass=\"mt-4\" @current-change=\"afterSalePageChange\"\r\n/>\r\n\r\n<el-dialog\r\nv-model=\"dialogReplayVisible\"\r\n:width=\"dialogWidth\"\r\n>\r\n<h2 style=\"margin-bottom: 20px\">回复客户投诉</h2>\r\n<el-form \r\n  :model=\"replayForm\" \r\n  label-width=\"100px\"\r\n  label-position=\"top\"\r\n>\r\n  <el-form-item label=\"回复内容\" style=\"margin-bottom: 24px\">\r\n    <el-input \r\n      v-model=\"replayForm.content\" \r\n      type=\"textarea\"\r\n      :rows=\"4\"\r\n      resize=\"none\"\r\n      placeholder=\"请输入回复内容\"\r\n    />\r\n  </el-form-item>\r\n  <el-form-item style=\"text-align: right; margin-top: 24px\">\r\n    <el-button @click=\"dialogReplayVisible = false\">取消</el-button>\r\n    <el-button type=\"primary\" @click=\"subReplayForm\">保存</el-button>\r\n  </el-form-item>\r\n</el-form>\r\n</el-dialog>\r\n\r\n<el-dialog\r\nv-model=\"dialogReplayListVisible\"\r\nwidth=\"80%\"\r\n>\r\n  <h2>回复列表</h2>\r\n  <div style=\"text-align: left\">  \r\n    <el-text>投诉客户:{{question.custName}}</el-text>\r\n    <el-text>投诉问题:{{question.quesDesc}}</el-text>\r\n    <el-table :data=\"replaysList\" style=\"width: 100%\">\r\n  <el-table-column prop=\"id\" label=\"编号\"  />\r\n  <el-table-column prop=\"redate\" label=\"时间\" />\r\n  <el-table-column prop=\"score\" label=\"评分\" />\r\n  <el-table-column prop=\"content\" label=\"内容\" />\r\n  \r\n  <el-table-column fixed=\"right\" label=\"操作\">\r\n    <template #default=\"scope\">\r\n      <el-button link type=\"primary\" size=\"small\" @click=\"openReplayDialog(scope.row.id)\">处理</el-button>\r\n      <el-button link type=\"primary\" size=\"small\" @click=\"loadQuesttionReplayList(scope.row)\">查看处理详情</el-button>\r\n    </template>\r\n  </el-table-column>\r\n</el-table>\r\n\r\n  <hr/>\r\n\r\n  <el-pagination\r\n          small\r\n          background\r\n          :page-size=\"6\"\r\n          :pager-count=\"10\"\r\n          layout=\"prev, pager, next\"\r\n          :total=\"totalReplay\"\r\n          class=\"mt-4\" @current-change=\"handlerReplayPageChange\"/>\r\n\r\n  </div>\r\n\r\n\r\n</el-dialog>\r\n</template>\r\n\r\n<script setup>\r\nimport { onMounted,reactive,ref } from 'vue'\r\nimport axios from 'axios'\r\nimport { ElMessage } from 'element-plus'\r\n\r\n\r\nconst afterSaleList = ref([])\r\nconst total = ref(0)\r\nconst condForm=reactive({\r\n  id:'',\r\n  question:'',\r\n  grade:'',\r\n  level:''\r\n})\r\n\r\nfunction queryAfterSaleList(pageNum){\r\n  condForm.pageNum=pageNum\r\n  axios.post(\"http://localhost:8081/listAfterSale\",condForm)\r\n  .then((response)=>{\r\n    afterSaleList.value = response.data.afterSalesList\r\n    total.value=response.data.total\r\n  })\r\n  .catch((error)=>{\r\n    console.log(error)\r\n  })\r\n}\r\n\r\nonMounted(function () {\r\n  queryAfterSaleList(1)\r\n})\r\n\r\nfunction afterSalePageChange(pageNum){\r\n  queryAfterSaleList(pageNum)\r\n}\r\n\r\nfunction subQueryAfter(){\r\n  queryAfterSaleList(1)\r\n}\r\n\r\nconst dialogReplayVisible=ref(false)\r\nconst dialogWidth=ref('50%')\r\nconst replayForm=reactive({\r\n  content:''\r\n})\r\n\r\nonMounted(() => {\r\n  updateDialogWidth()\r\n  window.addEventListener('resize', updateDialogWidth)\r\n})\r\n\r\nfunction updateDialogWidth() {\r\n  dialogWidth.value = window.innerWidth < 768 ? '90%' : '50%'\r\n}\r\n\r\nfunction openReplayDialog(qid){\r\n  dialogReplayVisible.value=true\r\n  replayForm.quesId=qid\r\n}\r\n\r\nfunction subReplayForm(){\r\n  axios.post(\"http://localhost:8081/saveReplay\",replayForm)\r\n  .then((response)=>{\r\n    if(response.data.code==200){\r\n      dialogReplayVisible.value=false\r\n      replayForm.content=''\r\n      ElMessage(response.data.msg)\r\n    }else{\r\n      ElMessage.error(response.data.msg)\r\n    }\r\n  })\r\n  .catch((error)=>{\r\n    console.log(error)\r\n  })\r\n}\r\n\r\nconst dialogReplayListVisible=ref(false)\r\nconst question=reactive({\r\n  custName:'',\r\n  quesDesc:''\r\n})\r\n\r\nconst totalReplay=ref(0)\r\nconst replaysList=ref([])\r\nlet qid=0\r\n\r\n\r\nfunction loadQuesttionReplayList(row){\r\n    dialogReplayListVisible.value=true;\r\n    question.custName=row.custName;\r\n    question.quesDesc=row.question;\r\n    qid=row.id;\r\n    //发送ajax请求\r\n    axios.get(\"http://localhost:8081/listReplay?id=\"+row.id)\r\n    .then((response)=>{\r\n      replaysList.value=response.data.replayList;\r\n      totalReplay.value=response.data.total;\r\n    })\r\n    .catch((error)=>{\r\n      console.log(error);\r\n    })\r\n  }\r\n\r\n  //提交分页查询参数的请求\r\n  function handlerReplayPageChange(pageNum){\r\n    //发送ajax请求\r\n    axios.get(\"http://localhost:8081/listReplay?id=\"+qid+\"&pageNum=\"+pageNum)\r\n        .then((response)=>{\r\n          replaysList.value=response.data.replayList;\r\n          totalReplay.value=response.data.total;\r\n        })\r\n        .catch((error)=>{\r\n          console.log(error);\r\n        })\r\n  }\r\n\r\n</script>\r\n\r\n<style>\r\n\r\n</style>"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}